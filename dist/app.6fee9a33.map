{"version":3,"sources":["js\\app.js"],"names":["SpeechRecognition","tntBtn","document","getElementById","onclick","parentNode","removeChild","style","display","innerText","window","webkitSpeechRecognition","recognition","e","console","error","alert","noteTextarea","instructions","noteContent","continuous","onresult","event","current","resultIndex","transcript","results","mobileRepeatBug","onstart","onerror","addEventListener","log","start","length","stop","d","Date","text","getFullYear","getMonth","getDate","input","files","type","indexOf","url","blob","URL","createObjectURL","getBase64","then","src","data","catch","querySelectorAll","forEach","el","index","list","imgSrc","file","Promise","resolve","reject","reader","FileReader","readAsDataURL","onload","result","ToggleClass","classname","classList","contains","remove","add","newCanvas","callback","html2canvas","allowTaint","taintTest","width","offsetWidth","height","offsetHeight","scale","canvas","toDataURL","setTimeout","scrollTo","body","scrollHeight","err","click","querySelector","a","createElement","href","download"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAC,aAAU;;AAEP,aAASA,iBAAT,GAA4B;AACxB,YAAIC,SAASC,SAASC,cAAT,CAAwB,KAAxB,CAAb;;AAGA;AACAD,iBAASC,cAAT,CAAwB,WAAxB,EAAqCC,OAArC,GAA+C,YAAU;AACrD,iBAAKC,UAAL,CAAgBC,WAAhB,CAA4B,IAA5B;AACAJ,qBAASC,cAAT,CAAwB,KAAxB,EAA+BI,KAA/B,CAAqCC,OAArC,GAA+C,OAA/C;AACAN,qBAASC,cAAT,CAAwB,wBAAxB,EAAkDM,SAAlD,GAA8D,4DAA9D;AACH,SAJD;;AAMA,YAAI;AACA,gBAAIT,oBAAoBU,OAAOV,iBAAP,IAA4BU,OAAOC,uBAA3D;AACA,gBAAIC,cAAc,IAAIZ,iBAAJ,EAAlB;AACH,SAHD,CAGE,OAAOa,CAAP,EAAU;AACRC,oBAAQC,KAAR,CAAcF,CAAd;AACAZ,mBAAOI,UAAP,CAAkBC,WAAlB,CAA8BL,MAA9B;AACAe,kBAAM,eAAN;AACH;;AAGD,YAAIC,eAAef,SAASC,cAAT,CAAwB,MAAxB,CAAnB;AACA,YAAIe,eAAehB,SAASC,cAAT,CAAwB,wBAAxB,CAAnB;AACA,YAAIgB,cAAc,EAAlB;;AAEAP,oBAAYQ,UAAZ,GAAyB,IAAzB;;AAEAR,oBAAYS,QAAZ,GAAuB,UAACC,KAAD,EAAU;AAC7B,gBAAIC,UAAUD,MAAME,WAApB;;AAEA;AACA,gBAAIC,aAAaH,MAAMI,OAAN,CAAcH,OAAd,EAAuB,CAAvB,EAA0BE,UAA3C;;AAEA;AACA,gBAAIE,kBAAmBJ,WAAW,CAAX,IAAgBE,cAAcH,MAAMI,OAAN,CAAc,CAAd,EAAiB,CAAjB,EAAoBD,UAAzE;;AAEA,gBAAI,CAACE,eAAL,EAAsB;AAClBR,+BAAeM,UAAf;AACAR,6BAAaR,SAAb,GAAyBU,WAAzB;AACH;AACJ,SAbD;;AAeAP,oBAAYgB,OAAZ,GAAsB,UAACf,CAAD,EAAM;AACxBK,yBAAaT,SAAb,GAAyB,WAAzB;AACH,SAFD;;AAIAG,oBAAYiB,OAAZ,GAAsB,UAACP,KAAD,EAAU;AAC5B,gBAAIA,MAAMP,KAAN,IAAe,WAAnB,EAAgC;AAC5BG,6BAAaT,SAAb,GAAyB,cAAzB;AACH;AACJ,SAJD;;AAMAP,iBAASC,cAAT,CAAwB,iBAAxB,EAA2C2B,gBAA3C,CAA4D,OAA5D,EAAqE,aAAG;AACpEhB,oBAAQiB,GAAR,CAAY,MAAZ;AACAnB,wBAAYoB,KAAZ;AACA,gBAAIb,YAAYc,MAAhB,EAAwB;AACpBd,+BAAe,GAAf;AACH;AACJ,SAND;;AAQAjB,iBAASC,cAAT,CAAwB,gBAAxB,EAA0C2B,gBAA1C,CAA2D,OAA3D,EAAoE,aAAG;AACnEhB,oBAAQiB,GAAR,CAAY,MAAZ;AACAnB,wBAAYsB,IAAZ;AACAhB,yBAAaT,SAAb,GAAyB,QAAzB;AACH,SAJD;AAKH;AACDT;;AAEA;AACA,QAAImC,IAAI,IAAIC,IAAJ,EAAR;AACA,QAAIC,OAAOF,EAAEG,WAAF,KAAgB,GAAhB,IAAqBH,EAAEI,QAAF,KAAa,CAAlC,IAAqC,GAArC,GAAyCJ,EAAEK,OAAF,EAAzC,GAAqD,qGAAhE;AACAtC,aAASC,cAAT,CAAwB,MAAxB,EAAgCM,SAAhC,GAA4C4B,IAA5C;;AAEA;AACA,QAAII,QAAQvC,SAASC,cAAT,CAAwB,MAAxB,CAAZ;AACAsC,UAAMX,gBAAN,CAAuB,QAAvB,EAAiC,UAASjB,CAAT,EAAW;AACxC,YAAI6B,QAAQD,MAAMC,KAAlB;AACA,YAAGA,MAAMT,MAAT,EAAgB;AACZ,gBAAGS,MAAM,CAAN,EAASC,IAAT,CAAcC,OAAd,CAAsB,KAAtB,KAAgC,CAAC,CAApC,EAAsC;AAClC5B,sBAAM,WAAN;AACH,aAFD,MAEK;AACD,oBAAI6B,MAAMC,OAAOC,IAAIC,eAAJ,CAAoBN,MAAM,CAAN,CAApB,CAAjB;AACAO,0BAAUP,MAAM,CAAN,CAAV,EAAoBQ,IAApB,CACI,gBAAQ;AACJhD,6BAASC,cAAT,CAAwB,WAAxB,EAAqCgD,GAArC,GAA2CC,IAA3C;AACH,iBAHL,EAIEC,KAJF,CAIQ,eAAK;AACTrC,0BAAM,mBAAN;AACH,iBAND;AAOH;AACJ;AACJ,KAhBD,EAgBG,KAhBH;;AAkBA;AACAd,aAASoD,gBAAT,CAA0B,iBAA1B,EAA6CC,OAA7C,CAAqD,UAACC,EAAD,EAAKC,KAAL,EAAYC,IAAZ,EAAmB;AACpEF,WAAG1B,gBAAH,CAAoB,OAApB,EAA6B,UAASjB,CAAT,EAAW;AACpC,gBAAI8C,SAAS,KAAKR,GAAlB;AACAjD,qBAASC,cAAT,CAAwB,WAAxB,EAAqCgD,GAArC,GAA2CQ,MAA3C;AACH,SAHD,EAGG,KAHH;AAIH,KALD;;AAOA;AACA,aAASV,SAAT,CAAmBW,IAAnB,EAAyB;AACrB,eAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACpC,gBAAMC,SAAS,IAAIC,UAAJ,EAAf;AACAD,mBAAOE,aAAP,CAAqBN,IAArB;AACAI,mBAAOG,MAAP,GAAgB;AAAA,uBAAML,QAAQE,OAAOI,MAAf,CAAN;AAAA,aAAhB;AACAJ,mBAAOnC,OAAP,GAAiB;AAAA,uBAASkC,OAAOhD,KAAP,CAAT;AAAA,aAAjB;AACH,SALM,CAAP;AAMH;;AAED;AACA,aAASsD,WAAT,CAAqBb,EAArB,EAAyBc,SAAzB,EAAmC;AAC/B,YAAGd,GAAGe,SAAH,CAAaC,QAAb,CAAsBF,SAAtB,CAAH,EAAoC;AAChCd,eAAGe,SAAH,CAAaE,MAAb,CAAoBH,SAApB;AACH,SAFD,MAEK;AACDd,eAAGe,SAAH,CAAaG,GAAb,CAAiBJ,SAAjB;AACH;AACJ;;AAED;AACA,aAASK,SAAT,CAAmBnB,EAAnB,EAAuBoB,QAAvB,EAAgC;AAC5BC,oBAAYrB,EAAZ,EAAgB;AACZsB,wBAAY,IADA;AAEZC,uBAAW,KAFC;AAGZC,mBAAOxB,GAAGyB,WAHE;AAIZC,oBAAQ1B,GAAG2B,YAJC;AAKZC,mBAAO;AALK,SAAhB,EAMGlC,IANH,CAMQ,kBAAQ;AACZhD,qBAASC,cAAT,CAAwB,QAAxB,EAAkCgD,GAAlC,GAAwCkC,OAAOC,SAAP,CAAiB,WAAjB,CAAxC;AACAC,uBAAW,YAAM;AACb7E,uBAAO8E,QAAP,CAAgB,CAAhB,EAAkBtF,SAASuF,IAAT,CAAcC,YAAhC;AACH,aAFD,EAEG,GAFH;AAGH,SAXD,EAWGrC,KAXH,CAWS,eAAK;AACVrC,kBAAM,sBAAoB2E,GAA1B;AACH,SAbD;AAcH;;AAED;AACAzF,aAASC,cAAT,CAAwB,WAAxB,EAAqC2B,gBAArC,CAAsD,OAAtD,EAA+D,UAASjB,CAAT,EAAW;AACtE4B,cAAMmD,KAAN;AACH,KAFD,EAEG,KAFH;;AAIA;AACA1F,aAASC,cAAT,CAAwB,gBAAxB,EAA0C2B,gBAA1C,CAA2D,OAA3D,EAAoE,UAASjB,CAAT,EAAW;AAC3E,YAAI2C,KAAK,KAAKnD,UAAL,CAAgBA,UAAhB,CAA2BwF,aAA3B,CAAyC,WAAzC,CAAT;AACAxB,oBAAYb,EAAZ,EAAgB,QAAhB;AACH,KAHD,EAGG,KAHH;;AAKA;AACAtD,aAASC,cAAT,CAAwB,WAAxB,EAAqC2B,gBAArC,CAAsD,OAAtD,EAA+D,UAASjB,CAAT,EAAW;AACtE,YAAI2C,KAAK,KAAKnD,UAAL,CAAgBA,UAAhB,CAA2BwF,aAA3B,CAAyC,WAAzC,CAAT;AACAxB,oBAAYb,EAAZ,EAAgB,MAAhB;AACH,KAHD,EAGG,KAHH;;AAKA;AACAtD,aAASC,cAAT,CAAwB,UAAxB,EAAoC2B,gBAApC,CAAqD,OAArD,EAA8D,UAASjB,CAAT,EAAW;AACrE,YAAI2C,KAAK,KAAKnD,UAAL,CAAgBA,UAAhB,CAA2BwF,aAA3B,CAAyC,OAAzC,CAAT;AACAlB,kBAAUnB,EAAV,EAAc,UAASX,GAAT,EAAa;AACvB,gBAAIiD,IAAI5F,SAAS6F,aAAT,CAAuB,GAAvB,CAAR;AACAD,cAAEE,IAAF,GAASnD,GAAT;AACAiD,cAAEG,QAAF,GAAa,SAAb;AACAH,cAAEF,KAAF;AACH,SALD;AAMH,KARD,EAQG,KARH;AASH,CAvKA,GAAD","file":"app.6fee9a33.map","sourceRoot":"..\\src","sourcesContent":["(function(){\r\n\r\n    function SpeechRecognition(){\r\n        let tntBtn = document.getElementById('tnt');\r\n\r\n\r\n        // 显示录音按钮\r\n        document.getElementById('start-tnt').onclick = function(){\r\n            this.parentNode.removeChild(this);\r\n            document.getElementById('tnt').style.display = 'block';\r\n            document.getElementById('recording-instructions').innerText = '已开启 TNT 模式, 仅支持小部分现代浏览器, 请授权网页使用麦克风, 代码在本地环境运行, 不会上传您的任何信息'\r\n        }\r\n\r\n        try {\r\n            var SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\r\n            var recognition = new SpeechRecognition();\r\n        } catch (e) {\r\n            console.error(e);\r\n            tntBtn.parentNode.removeChild(tntBtn);\r\n            alert('您的浏览器暂不支持语音识别')\r\n        }\r\n\r\n\r\n        let noteTextarea = document.getElementById('text');\r\n        let instructions = document.getElementById('recording-instructions');\r\n        let noteContent = '';\r\n\r\n        recognition.continuous = true;\r\n\r\n        recognition.onresult = (event)=> {\r\n            let current = event.resultIndex;\r\n\r\n            // 获取识别后的内容\r\n            let transcript = event.results[current][0].transcript;\r\n\r\n            // 解决安卓设备的bug\r\n            let mobileRepeatBug = (current == 1 && transcript == event.results[0][0].transcript);\r\n\r\n            if (!mobileRepeatBug) {\r\n                noteContent += transcript;\r\n                noteTextarea.innerText = noteContent;\r\n            }\r\n        };\r\n\r\n        recognition.onstart = (e)=> {\r\n            instructions.innerText = '正在识别, 请讲话';\r\n        }\r\n\r\n        recognition.onerror = (event)=> {\r\n            if (event.error == 'no-speech') {\r\n                instructions.innerText = '未检测到语音，请再试一次';\r\n            };\r\n        }\r\n\r\n        document.getElementById('start-recording').addEventListener('click', e=>{\r\n            console.log('开始录音');\r\n            recognition.start();\r\n            if (noteContent.length) {\r\n                noteContent += ' ';\r\n            }\r\n        })\r\n\r\n        document.getElementById('stop-recording').addEventListener('click', e=>{\r\n            console.log('录音停止');\r\n            recognition.stop();\r\n            instructions.innerText = '语音识别暂停';\r\n        })\r\n    }\r\n    SpeechRecognition()\r\n\r\n    // 设置日期\r\n    let d = new Date();\r\n    let text = d.getFullYear()+'年'+(d.getMonth()+1)+'月'+d.getDate()+'日，晴。和昨天一样没吃饭。一直在群里等人带我。  昨天说好今天带我的，现在他们又说今天要援交没有时间带我，还说不仅今天往后11号、12号都不会带我，居然还说以后都不带我了，简直不能忍一定要好好记下来';\r\n    document.getElementById('text').innerText = text;\r\n\r\n    // 上传本地图片\r\n    let input = document.getElementById('file');\r\n    input.addEventListener('change', function(e){\r\n        let files = input.files\r\n        if(files.length){\r\n            if(files[0].type.indexOf('gif') != -1){\r\n                alert('暂不支持GIF文件')\r\n            }else{\r\n                let url = blob = URL.createObjectURL(files[0]);\r\n                getBase64(files[0]).then(\r\n                    data => {\r\n                        document.getElementById('uploadImg').src = data;\r\n                    }\r\n                ).catch(err=>{\r\n                    alert('上传失败, 请尝试更换浏览器后重试')\r\n                });\r\n            }\r\n        }\r\n    }, false)\r\n\r\n    // 切换图片\r\n    document.querySelectorAll('.select-img img').forEach((el, index, list)=>{\r\n        el.addEventListener('click', function(e){\r\n            let imgSrc = this.src;\r\n            document.getElementById('uploadImg').src = imgSrc;\r\n        }, false)\r\n    })\r\n\r\n    // 文件转base64\r\n    function getBase64(file) {\r\n        return new Promise((resolve, reject) => {\r\n            const reader = new FileReader();\r\n            reader.readAsDataURL(file);\r\n            reader.onload = () => resolve(reader.result);\r\n            reader.onerror = error => reject(error);\r\n        });\r\n    }\r\n\r\n    // 切换class\r\n    function ToggleClass(el, classname){\r\n        if(el.classList.contains(classname)){\r\n            el.classList.remove(classname);\r\n        }else{\r\n            el.classList.add(classname);\r\n        }\r\n    }\r\n\r\n    // 生成canvas\r\n    function newCanvas(el, callback){\r\n        html2canvas(el, {\r\n            allowTaint: true,\r\n            taintTest: false,\r\n            width: el.offsetWidth,\r\n            height: el.offsetHeight,\r\n            scale: 2\r\n        }).then(canvas=>{\r\n            document.getElementById('canvas').src = canvas.toDataURL(\"image/png\");\r\n            setTimeout(() => {\r\n                window.scrollTo(0,document.body.scrollHeight)\r\n            }, 300);\r\n        }).catch(err=>{\r\n            alert('生成失败, 请尝试更换浏览器后重试'+err)\r\n        });\r\n    }\r\n\r\n    // 上传图片\r\n    document.getElementById('uploadImg').addEventListener('click', function(e){\r\n        input.click();\r\n    }, false)\r\n\r\n    // 居中\r\n    document.getElementById('font-centering').addEventListener('click', function(e){\r\n        let el = this.parentNode.parentNode.querySelector('.main pre');\r\n        ToggleClass(el, 'center')\r\n    }, false)\r\n\r\n    // 加粗\r\n    document.getElementById('font-bold').addEventListener('click', function(e){\r\n        let el = this.parentNode.parentNode.querySelector('.main pre');\r\n        ToggleClass(el, 'bold')\r\n    }, false)\r\n\r\n    // 下载\r\n    document.getElementById('download').addEventListener('click', function(e){\r\n        let el = this.parentNode.parentNode.querySelector('.main');\r\n        newCanvas(el, function(url){\r\n            let a = document.createElement('a');\r\n            a.href = url;\r\n            a.download = 'bqb.jpg';\r\n            a.click();\r\n        })\r\n    }, false)\r\n}())"]}